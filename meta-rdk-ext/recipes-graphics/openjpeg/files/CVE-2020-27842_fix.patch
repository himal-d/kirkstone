Date: Nov 30, 2023
From: fbd30b064f8f9607d500437b6fedc41431fd6cdc
Subject: Patch openjpeg to address CVE-2020-27842
Source:  Github  https://github.com/rouault/openjpeg/commit/fbd30b064f8f9607d500437b6fedc41431fd6cdc
License:
Upstream-Status: Pending
Signed-off-by: kmarim851 <Kalidoss_Marimuthu@comcast.com>
---
Index: git/src/lib/openjp2/t2.c
===================================================================
--- git.orig/src/lib/openjp2/t2.c
+++ git/src/lib/openjp2/t2.c
@@ -711,6 +711,15 @@ static OPJ_BOOL opj_t2_encode_packet(OPJ
                 continue;
             }
 
+            /* Avoid out of bounds access of https://github.com/uclouvain/openjpeg/issues/1294 */
+            /* but likely not a proper fix. */
+            if (precno >= res->pw * res->ph) {
+                opj_event_msg(p_manager, EVT_ERROR,
+                              "opj_t2_encode_packet(): accessing precno=%u >= %u\n",
+                              precno, res->pw * res->ph);
+		return OPJ_FALSE;
+	    }
+
             prc = &band->precincts[precno];
             opj_tgt_reset(prc->incltree);
             opj_tgt_reset(prc->imsbtree);
