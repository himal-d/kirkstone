Date: Nov 30, 2023
From: 38d661a3897052c7ff0b39b30c29cb067e130121
Subject: Patch openjpeg to address CVE-2020-27843
Source:  Github  https://github.com/uclouvain/openjpeg/commit/38d661a3897052c7ff0b39b30c29cb067e130121
License:
Upstream-Status: Pending
Signed-off-by: kmarim851 <Kalidoss_Marimuthu@comcast.com>
---
Index: git/src/lib/openjp2/t2.c
===================================================================
--- git.orig/src/lib/openjp2/t2.c
+++ git/src/lib/openjp2/t2.c
@@ -787,6 +787,15 @@ static OPJ_BOOL opj_t2_encode_packet(OPJ
             continue;
         }
 
+        /* Avoid out of bounds access of https://github.com/uclouvain/openjpeg/issues/1297 */
+	/* but likely not a proper fix. */
+        if (precno >= res->pw * res->ph) {
+            opj_event_msg(p_manager, EVT_ERROR,
+                          "opj_t2_encode_packet(): accessing precno=%u >= %u\n",
+			  precno, res->pw * res->ph);
+	    return OPJ_FALSE;
+	}
+
         prc = &band->precincts[precno];
         l_nb_blocks = prc->cw * prc->ch;
         cblk = prc->cblks.enc;
