From 30d6588756484937bb962daafe54cf2f2d51969f Mon Sep 17 00:00:00 2001
From: Alluri Revathi Bhavani <RevathiBhavani_Alluri@comcast.com>
Date: Mon, 10 Apr 2023 11:05:14 +0000
Subject: [PATCH] Date:  December 15,2020 From:
 03a820b173ed1fdef6ff14b4468f5dbc02ff59be Subject: [PATCH] CVE-2020-35492
 Source:
 https://gitlab.freedesktop.org/cairo/cairo/-/commit/03a820b173ed1fdef6ff14b4468f5dbc02ff59be
 License: GPLV2 Upstream-Status:
 https://gitlab.freedesktop.org/cairo/cairo/-/commit/03a820b173ed1fdef6ff14b4468f5dbc02ff59be
 Signed-off-by:  Heiko Lewin / aallur481(RevathiBhavani_Alluri@comcast.com)
 Patch recreated by: Rakhil P E <Rakhil_PuthiyaveettilEdachena@comcast.com>
---

diff --git a/test/Makefile.sources b/test/Makefile.sources
index c47131f..5797e04 100644
--- a/test/Makefile.sources
+++ b/test/Makefile.sources
@@ -33,6 +33,7 @@ test_sources = \
 	bug-source-cu.c					\
 	bug-extents.c					\
 	bug-seams.c					\
+    bug-image-compositor.c				\
 	caps.c						\
 	checkerboard.c					\
 	caps-joins.c					\
diff --git a/test/bug-image-compositor.c b/test/bug-image-compositor.c
new file mode 100644
index 0000000..3bc3cde
--- /dev/null
+++ b/test/bug-image-compositor.c
@@ -0,0 +1,38 @@
+#include "cairo-test.h"
+
+static cairo_test_status_t
+draw (cairo_t *cr, int width, int height)
+{
+    cairo_set_source_rgb (cr, 0., 0., 0.);
+    cairo_paint (cr);
+
+    cairo_set_source_rgb (cr, 1., 1., 1.);
+    cairo_set_line_width (cr, 1.);
+
+    cairo_pattern_t *p = cairo_pattern_create_linear (0, 0, width, height);
+    cairo_pattern_add_color_stop_rgb (p, 0, 0.99, 1, 1);
+    cairo_pattern_add_color_stop_rgb (p, 1, 1, 1, 1);
+    cairo_set_source (cr, p);
+
+    cairo_move_to (cr, 0.5, -1);
+    for (int i = 0; i < width; i+=3) {
+	cairo_rel_line_to (cr, 2, 2);
+	cairo_rel_line_to (cr, 1, -2);
+    }
+
+    cairo_set_operator (cr, CAIRO_OPERATOR_SOURCE);
+    cairo_stroke (cr);
+
+    cairo_pattern_destroy(p);
+
+    return CAIRO_TEST_SUCCESS;
+}
+
+
+CAIRO_TEST (bug_image_compositor,
+	    "Crash in image-compositor",
+	    "stroke, stress", /* keywords */
+	    NULL, /* requirements */
+	    10000, 1,
+	    NULL, draw)
+
