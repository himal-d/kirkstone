Date: Feb 28, 2024
From: sipra_samantaray2@comcast.com
CVE : CVE-2022-28391
Source: upstream
       https://git.openembedded.org/openembedded-core/commit/?h=dunfell&id=0b9cbcc4ceac3938afd1dd6010ce6d9a3da21598
===================================================================
--- git.orig/libbb/xconnect.c	2024-02-07 21:19:08.634161581 +0000
+++ git/libbb/xconnect.c	2024-02-07 21:21:21.138756476 +0000
@@ -501,8 +501,9 @@ static char* FAST_FUNC sockaddr2str(cons
 	);
 	if (rc)
 		return NULL;
+	/* ensure host contains only printable characters */
 	if (flags & IGNORE_PORT)
-		return xstrdup(host);
+	        return xstrdup(printable_string(host));
 #if ENABLE_FEATURE_IPV6
 	if (sa->sa_family == AF_INET6) {
 		if (strchr(host, ':')) /* heh, it's not a resolved hostname */
@@ -513,7 +514,7 @@ static char* FAST_FUNC sockaddr2str(cons
 #endif
 	/* For now we don't support anything else, so it has to be INET */
 	/*if (sa->sa_family == AF_INET)*/
-		return xasprintf("%s:%s", host, serv);
+		return xasprintf("%s:%s", printable_string(host), serv);
 	/*return xstrdup(host);*/
 }
 
--- git.orig/networking/nslookup.c	2024-02-07 21:24:03.834574146 +0000
+++ git/networking/nslookup.c	2024-02-07 21:01:15.929637990 +0000
@@ -404,7 +404,7 @@ static int parse_reply(const unsigned ch
 				//printf("Unable to uncompress domain: %s\n", strerror(errno));
 				return -1;
 			}
-			printf(format, ns_rr_name(rr), dname);
+			printf(format, ns_rr_name(rr), printable_string(dname));
 			break;
 
 		case ns_t_mx:
@@ -419,7 +419,7 @@ static int parse_reply(const unsigned ch
 				//printf("Cannot uncompress MX domain: %s\n", strerror(errno));
 				return -1;
 			}
-			printf("%s\tmail exchanger = %d %s\n", ns_rr_name(rr), n, dname);
+			printf("%s\tmail exchanger = %d %s\n", ns_rr_name(rr), n, printable_string(dname));
 			break;
 
 		case ns_t_txt:
@@ -431,7 +431,7 @@ static int parse_reply(const unsigned ch
 			if (n > 0) {
 				memset(dname, 0, sizeof(dname));
 				memcpy(dname, ns_rr_rdata(rr) + 1, n);
-				printf("%s\ttext = \"%s\"\n", ns_rr_name(rr), dname);
+				printf("%s\ttext = \"%s\"\n", ns_rr_name(rr), printable_string(dname));
 			}
 			break;
 
@@ -461,7 +461,7 @@ static int parse_reply(const unsigned ch
 				return -1;
 			}
 
-			printf("\tmail addr = %s\n", dname);
+			printf("\tmail addr = %s\n", printable_string(dname));
 			cp += n;
 
 			printf("\tserial = %lu\n", ns_get32(cp));
