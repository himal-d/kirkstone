Date:   Feb 11, 2024
From:   SrihariRaghava_konduritirumala@comcast.com
Source: upstream
        https://sourceware.org/bugzilla/attachment.cgi?id=12219
Index: git/posix/glob.c
===================================================================
--- git.orig/posix/glob.c
+++ git/posix/glob.c
@@ -827,6 +827,9 @@ __glob (const char *pattern, int flags,
 	      {
 		size_t home_len = strlen (p->pw_dir);
 		size_t rest_len = end_name == NULL ? 0 : strlen (end_name);
+		/* dirname contains end_name; we can't free it now.  */
+		char *prev_dirname =
+                  (__glibc_unlikely (malloc_dirname) ? dirname : NULL);
 		char *d, *newp;
 		bool use_alloca = glob_use_alloca (alloca_used,
 						   home_len + rest_len + 1);
@@ -838,6 +841,7 @@ __glob (const char *pattern, int flags,
 		    newp = malloc (home_len + rest_len + 1);
 		    if (newp == NULL)
 		      {
+			free (prev_dirname);
 			scratch_buffer_free (&pwtmpbuf);
 			retval = GLOB_NOSPACE;
 			goto out;
@@ -848,8 +852,8 @@ __glob (const char *pattern, int flags,
 		  d = mempcpy (d, end_name, rest_len);
 		*d = '\0';
 
-		if (__glibc_unlikely (malloc_dirname))
-		  free (dirname);
+		free (prev_dirname);
+
 		dirname = newp;
 		malloc_dirname = !use_alloca;
 
